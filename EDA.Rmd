---
title: "Exploratory Data Analysis"
author: "Ekim Buyuk"
date: "2/8/2019"
output: pdf_document
---

```{r,include=FALSE}
if (!require("readxl")) install.packages("readxl") 
library(readxl) 
if (!require("MASS")) install.packages("MASS") 
library(MASS)
if (!require("sf")) install.packages("sf")
library(sf)
if (!require("ggplot2")) install.packages("ggplot2")
library(ggplot2)
if (!require("stringr")) install.packages("stringr")
library(stringr)
if (!require("tidyr")) install.packages("tidyr")
library(tidyr)
if (!require("mapview")) install.packages("mapview")
library(mapview)
if (!require("purrr")) install.packages("purrr")
library(purrr)
if (!require("xgboost")) install.packages("xgboost")
library(xgboost)
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
if (!require("FedData")) install.packages("FedData")
library(FedData)
if (!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
if (!require("tidycensus")) install.packages("tidycensus")
library(tidycensus)
if (!require("fuzzyjoin")) install.packages("fuzzjoin")
library(fuzzyjoin)
if (!require("lubridate")) install.packages("lubridate")
library(lubridate)
if (!require("lme4")) install.packages("lme4")
library(lme4)
if (!require("glmm")) install.packages("glmm")
library(glmm)
if (!require("spdep")) install.packages("spdep")
library(spdep)
if (!require("xlsx")) install.packages("xlsx")
library(xlsx)
if (!require("fuzzyjoin")) install.packages("fuzzyjoin")
library(fuzzyjoin)
knitr::opts_chunk$set(cache=TRUE, echo=F, warning=F, message=F)
options(warn = -1)
```

```{r,include=FALSE}
census_tract_eda = sf::st_read("census_2010_nc_tract", quiet = TRUE, stringsAsFactors = FALSE) %>% filter(CNTY_FIPS == "063") 
census_sf_eda = sf::st_read("census_sf", quiet = TRUE, stringsAsFactors = FALSE) 
complete_data <-  sf::st_read("complete_data", quiet = TRUE, stringsAsFactors = FALSE)
durham_apts <- read.csv("new_durham_apts_edited_plus_nas_covered.csv") 
```

# Evictions

```{r}
evic_by_year = complete_data_eda %>% count(year)

#Plot of Evictions By Year
evics_by_year_plot <- ggplot(data=evic_by_year, aes(x=year, y=n)) +
  geom_bar(stat = "identity") +
  ggtitle("Number of Evictions In Multi-Family Dwellings by Year")

evics_by_year_plot
```

As we can see from this graph, there was a dip in evictions in 2004, and a rise between 2005 to 2010 when evictions hit their peak. From there, there was a dip from 2012 to 2017, and we saw another sharp rise this year in 2018. It is not super obvious why there was such a sharp rise in evictions in 2018. 

```{r}
evic_2018 = complete_data_eda %>% filter((substr(Statsdt,1,4) == "2018")) %>% count(Statsdt)

evic_2018_plot <- ggplot(evic_2018, aes(Statsdt, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ggtitle("Evictions in 2018")

evic_2018_plot

evic_nov_26_18 <- complete_data_eda %>% filter(Statsdt == "2018-11-26")
```

As we can see in this graph showing evictions in 2018, eviction numbers appears to follow a cyclical pattern. There also appears to be more evictions that occur in the second half of the year as the range of evictions seems to switch between August and September from 0-50 to 0 to 100 for most dates. There also appears to be a huge spike in November of 2018. This occurs on November 26, 2018. One potential reason this might be happenning may be that a lot of Durham residents are employed by Duke, and following Thanksgiving break, may not be getting their full salary, and therefore are unable to pay their rents. 

We look to see if this is indeed a common trend across all years. 

```{r}
evic_2001 = complete_data_eda %>% filter(year == "2001") %>% count(Statsdt)

evic_2001_plot <- ggplot(evic_2001, aes(Statsdt, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ggtitle("Evictions in 2001")

evic_2001_plot

evic_2009 = complete_data_eda %>% filter(year == "2009") %>% count(Statsdt)

evic_2009_plot <- ggplot(evic_2001, aes(Statsdt, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ggtitle("Evictions in 2009")

evic_2009_plot
```

Looking at the graphs of 2001 and 2009, we do not see a spike in eviction numbers in December as we did in 2018, though it is clear that eviction numbers are increasing in the second half of the year. This suggests that the spike in November of 2018 is indeed abnormal. What more, the scale of these graphs are between 0 and 50, whereas while most eviction numbers were between 0 and 50 for the 2018 graph, there were 162 evictions at the height of the spike. 


```{r}
evic_by_date =  complete_data_eda %>% count(Statsdt)

ggplot(evic_by_date, aes(Statsdt, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  ggtitle("Evictions By Date")

```

Though it is a bit harder to see from this graph of all years, we see that the spikes we saw in 2018 do appear at other times, as well in the past, but are still never to the degree we saw in 2018. This suggests a further investigation into what happened on this date.

Also, there is something super strange going on in 2003 so we check that out closer. 

```{r}
evic_2003 = complete_data_eda %>% filter(year == "2003") %>% count(Statsdt) 
 
evic_2003_plot <- ggplot(evic_2003, aes(Statsdt, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ggtitle("Evictions in 2003")
 
evic_2003_plot
```

Strangely, no evictions before September of 2003 are registering... It is a problem with the data! Looking at original evictions geocoded data, there are 2 evictions that take place before August so there is some weird missing data issue here. Will follow up on this specifically but not an error on user end. 

# Evictions by Tract 

```{r}
census_tract_eda <- sf::st_transform(census_tract_eda, crs = 2264)
parcels_in_tract <- st_join(census_tract_eda,census_sf_eda, join = st_intersects)

evics_per_unit <- complete_data_eda %>% group_by(PARCEL_ID_) %>% count()

parcels_in_tract$evic_total <- NA 
  
for (i in 1:length(parcels_in_tract$PARCEL_)) {
  for (j in 1:length(evics_per_unit$PARCEL_ID_)) {
    if (identical(parcels_in_tract$PARCEL_[i],evics_per_unit$PARCEL_ID_[j]) == TRUE) {
      parcels_in_tract$evic_total[i] = evics_per_unit$n[j]
    }
  }
}

apart_units_per_tract <- parcels_in_tract %>% group_by(TRACT) %>% 
  summarise(dwelling_count = sum(sum_du), 
            evic_totals = sum(evic_total,na.rm = TRUE))

apart_units_per_tract$evic_rate = apart_units_per_tract$evic_totals/(apart_units_per_tract$dwelling_count*19)

apart_evic_rates_tract <- apart_units_per_tract[order(-apart_units_per_tract$evic_rate),]

head(apart_evic_rates_tract,10)

evic_rates_tract <- ggplot() +
  geom_sf(data = census_tract_eda) +
  geom_sf(data=apart_units_per_tract, aes(fill = evic_rate)) +
  ggtitle("Eviction Rate For Each Tract Across 18 Years")

evic_rates_tract 
```

Here, we look at eviction rates for different tracts in Durham. Specifically, we get the total number of evictions that occurred in each parcel in each tract across all 19 years. We also get the total dwelling count for each tract. We then multiple the total dwelling count by 19 years, as a proxy for 19 possible years of evictions. Finally, we divide the total number of evictions over this number to get the eviction rate in a tract across all 19 years. As we can see, tracts near the center of the city tend to light up more. To get a more nuanced look at this, we next look at a year by year change in eviction rates:

# By Year

```{r,out.width=10,out.height=10} 
evic_by_tract_year <- st_join(census_tract_eda,complete_data_eda, join = st_intersects)

evics_per_unit_year <- evic_by_tract_year %>% group_by(TRACT,year) %>% count()

apart_units_per_tract <- parcels_in_tract %>% group_by(TRACT) %>% 
  summarise(dwelling_count = sum(sum_du))
  
evics_per_unit_year$dwelling_count <- NA
  
for (i in 1:length(evics_per_unit_year$TRACT)) {
  for (j in 1:length(apart_units_per_tract$TRACT)) {
    if (identical(evics_per_unit_year$TRACT[i],apart_units_per_tract$TRACT[j]) == TRUE) {
      evics_per_unit_year$dwelling_count[i] = apart_units_per_tract$dwelling_count[j]
    }
  }
}
evics_per_unit_year$evic_rate = NA
evics_per_unit_year$evic_rate = evics_per_unit_year$n/evics_per_unit_year$dwelling_count

evic_rate_by_year_tract <- ggplot() +
  geom_sf(data = census_tract_eda)+
  geom_sf(data=evics_per_unit_year, aes(fill = evic_rate)) +
  facet_wrap(~year) +
  ggtitle("Number of Evictions by Census Tract By Year")

evic_rate_by_year_tract

evics_per_unit_year_rate <- evics_per_unit_year[order(-evics_per_unit_year$evic_rate),]

head(evics_per_unit_year_rate,10)
```

# Correlations with Other Demographics 

```{r,eval=FALSE}
blacks_per_tract <- census_tract_eda %>% mutate(black_rate = BLACK/POP2010)
hispan_per_tract <- census_tract_eda %>% mutate(hispan_rate = HISPANIC/POP2010)

apart_units_per_tract$aa_rate = NA
apart_units_per_tract$hispan_rate = NA

for (i in 1:length(apart_units_per_tract$TRACT)) {
  for (j in 1:length(blacks_per_tract$TRACT)) {
    if (identical(apart_units_per_tract$TRACT[i],blacks_per_tract$TRACT[j]) == TRUE) {
      apart_units_per_tract$aa_rate[i] = blacks_per_tract$black_rate[j]
    }
  }
}

for (i in 1:length(apart_units_per_tract$TRACT)) {
  for (j in 1:length(hispan_per_tract$TRACT)) {
    if (identical(apart_units_per_tract$TRACT[i],hispan_per_tract$TRACT[j]) == TRUE) {
      apart_units_per_tract$hispan_rate[i] = hispan_per_tract$hispan_rate[j]
    }
  }
}

apart_units_per_tract$aa_rate = as.numeric(apart_units_per_tract$aa_rate)
apart_units_per_tract$hispan_rate = as.numeric(apart_units_per_tract$hispan_rate)
apart_units_per_tract$evic_rate = as.numeric(apart_units_per_tract$evic_rate)

cor(apart_units_per_tract$evic_rate,apart_units_per_tract$aa_rate,use = "complete.obs")

ggplot(data = apart_units_per_tract, aes(evic_rate,aa_rate)) +
  geom_point() +
  geom_text(aes(label=TRACT)) +
  ggtitle("Correlation Between Eviction Rates and Percent African American in Tracts")

cor(apart_units_per_tract$evic_rate,apart_units_per_tract$hispan_rate,use = "complete.obs")
 
ggplot(data = apart_units_per_tract, aes(evic_rate,hispan_rate)) +
  geom_point() +
  geom_text(aes(label=TRACT)) +
  ggtitle("Correlation Between Eviction Rates and Percent Hispanic in Tracts")

```

# More Demographics

```{r,eval=FALSE}
census_api_key("27ee87ac41c3d7a5b4a79e17c1003a46862d76fb", install = TRUE)
readRenviron("~/.Renviron")

durham_census <- get_acs(geography = "tract", variables = c(pop_unwtd_count = "B00001_001", housingunits_unwtd= "B00002_001", hisp_yes = "B03001_002", hisp_no = "B03001_003", white_alone = "B02001_002", black_alone = "B02001_003", american_indian_alone = "B02001_004", asian_alone = "B02001_005", native_hawaiian_alone= "B02001_006", other_alone = "B02001_007", household_income = "B19001_001", renter_occupied_units = "B07013_003"), state = "NC", county = c("Durham"))

durham_census$TRACT = NA
durham_census$TRACT = substr(durham_census$GEOID,6,11)
```

#Trends across years 

```{r}
evics_by_parcel_year <- complete_data %>% group_by(PARCEL_ID,year) %>% count()

evics_by_parcel_year$TRACT <- NA 
  
for (i in 1:length(evics_by_parcel_year$PARCEL_ID)) {
  for (j in 1:length(parcels_in_tract$PARCEL_)) {
    if (identical(parcels_in_tract$PARCEL_[j],as.character(evics_by_parcel_year$PARCEL_ID[i])) == TRUE) {
      evics_by_parcel_year$TRACT[i] = parcels_in_tract$TRACT[j]
    }
  }
}

evics_by_parcel_year_count <- evics_by_parcel_year %>% group_by(TRACT,year) %>% summarize(evic_total = sum(n))

evics_by_parcel_year_count$dwelling_count <- NA

for (i in 1:length(evics_by_parcel_year_count$TRACT)) {
  for (j in 1:length(apart_units_per_tract$TRACT)) {
    if (identical(evics_by_parcel_year_count$TRACT[i],apart_units_per_tract$TRACT[j]) == TRUE) {
      evics_by_parcel_year_count$dwelling_count[i] = apart_units_per_tract$dwelling_count[j]
    }
  }
}

evics_by_parcel_year_count$evic_rate <- evics_by_parcel_year_count$evic_total/evics_by_parcel_year_count$dwelling_count

evics_by_parcel_year_count$aa_rate <- NA

for (i in 1:length(evics_by_parcel_year_count$TRACT)) {
  for (j in 1:length(blacks_per_tract$TRACT)) {
    if (identical(evics_by_parcel_year_count$TRACT[i],blacks_per_tract$TRACT[j]) == TRUE) {
      evics_by_parcel_year_count$aa_rate[i] = blacks_per_tract$black_rate[j]
    }
  }
}

evics_by_parcel_year_count$hispan_rate <- NA
  
for (i in 1:length(evics_by_parcel_year_count$TRACT)) {
  for (j in 1:length(hispan_per_tract$TRACT)) {
    if (identical(evics_by_parcel_year_count$TRACT[i],hispan_per_tract$TRACT[j]) == TRUE) {
      evics_by_parcel_year_count$hispan_rate[i] = hispan_per_tract$hispan_rate[j]
    }
  }
}

evics_by_parcel_year_count$hsehld_inc <- NA

hsehldinc <- durham_census %>% filter(variable == "household_income") 

for (i in 1:length(evics_by_parcel_year_count$TRACT)) {
  for (j in 1:length(hsehldinc$TRACT)) {
    if (identical(evics_by_parcel_year_count$TRACT[i],hsehldinc$TRACT[j]) == TRUE) {
      evics_by_parcel_year_count$hsehld_inc[i] = hsehldinc$estimate[j]
    }
  }
}

write.csv(evics_by_parcel_year,"evics_by_parcel_year.csv")
write.csv(evics_by_parcel_year_count,"evics_by_parcel_year_count.csv")

```

```{r}
ggplot(data = evics_by_parcel_year_count, aes(aa_rate,evic_rate, colour=as.character(year))) +
  geom_line() +
  ggtitle("Correlation Between Eviction Rates and Percent African American in Tracts Across Years")

ggplot(data = evics_by_parcel_year_count, aes(evic_rate,hispan_rate, colour=as.character(year))) +
  geom_line() +
  ggtitle("Correlation Between Eviction Rates and Percent Hispanic in Tracts Across Years")

ggplot(data = evics_by_parcel_year_count, aes(evic_rate,hsehld_inc, colour=as.character(year))) +
  geom_line() +
  ggtitle("Correlation Between Eviction Rates and Household Income in Tracts Across Years")

ggplot(data = evics_by_parcel_year_count, aes(year,evic_rate, colour=as.character(TRACT))) +
  geom_line() +
  ggtitle("Eviction Rates in Tracts Across Years")
```

```{r}
evics_by_parcel_year_count$year_labels <-
  ifelse(evics_by_parcel_year_count$year==2004 | evics_by_parcel_year_count$year==2005 | evics_by_parcel_year_count$year==2006 | evics_by_parcel_year_count$year==2007, "pre_fin_crisis",
  ifelse(evics_by_parcel_year_count$year==2008 | evics_by_parcel_year_count$year==2009 | evics_by_parcel_year_count$year==2010 | evics_by_parcel_year_count$year==2011, "fin_crisis",
  ifelse(evics_by_parcel_year_count$year==2012 | evics_by_parcel_year_count$year==2013 | evics_by_parcel_year_count$year==2014 | evics_by_parcel_year_count$year==2015 | evics_by_parcel_year_count$year==2016 | evics_by_parcel_year_count$year==2017, "post_fin_crisis",
  ifelse(evics_by_parcel_year_count$year==2018, "year_2018", NA
         ))))

ggplot(data = evics_by_parcel_year_count, aes(aa_rate,log(evic_rate), colour=as.character(year_labels))) +
  geom_line() +
  ggtitle("Correlation Between Eviction Rates and Percent African American in Tracts Across Time Periods")

```

# Ownership 

```{r,include=FALSE}
#adding parcel count

total_parcels <- parcels_in_tract %>% count(TRACT)

apart_units_per_tract$parcel_count <- NA

for (i in 1:length(apart_units_per_tract$TRACT)) {
  for (j in 1:length(total_parcels$TRACT)) {
    if (identical(apart_units_per_tract$TRACT[i],total_parcels$TRACT[j]) == TRUE) {
      apart_units_per_tract$parcel_count[i] = total_parcels$n[j]
    }
  }
}
```

# Looking at REITs aggregated to tract level

```{r,eval=FALSE}
RHFS_class <- durham_apts %>% group_by(RHFS.Classifications) %>% count()

durham_apts_edited <- durham_apts %>% filter(RHFS.Classifications == "Private Equity" | RHFS.Classifications == "REIT" | RHFS.Classifications == "Business Corp" | RHFS.Classifications == "Individual" | RHFS.Classifications == "LLP, LP, or LLC")

RHFS_class <- durham_apts_edited %>% group_by(RHFS.Classifications) %>% count()

RHFS_class

#Rates of REITs by Tract 

REIT_parcels <- durham_apts %>% 
  filter(RHFS.Classifications == "REIT") %>% 
  select("PARCEL_ID")

REIT_parcels$PARCEL_ID <- as.character(REIT_parcels$PARCEL_ID)

REIT_parcels$TRACT <- NA

for (i in 1:length(REIT_parcels$PARCEL_ID)) {
  for (j in 1:length(parcels_in_tract$PARCEL_)) {
    if (identical(REIT_parcels$PARCEL_ID[i],parcels_in_tract$PARCEL_[j]) == TRUE) {
      REIT_parcels$TRACT[i] = parcels_in_tract$TRACT[j]
    }
  }
}

REIT_parcels <- REIT_parcels %>% count(TRACT) 

apart_units_per_tract$reit_count <- NA

for (i in 1:length(apart_units_per_tract$TRACT)) {
  for (j in 1:length(REIT_parcels$TRACT)) {
    if (identical(apart_units_per_tract$TRACT[i],REIT_parcels$TRACT[j]) == TRUE) {
      apart_units_per_tract$reit_count[i] = REIT_parcels$n[j]
    }
  }
}

apart_units_per_tract$reit_rate = apart_units_per_tract$reit_count/apart_units_per_tract$parcel_count

cor(apart_units_per_tract$evic_rate,apart_units_per_tract$reit_rate,use = "complete.obs")

ggplot(data = apart_units_per_tract, aes(evic_rate,reit_rate)) +
  geom_point()
```

# Checking Out Eviction Rates by Owner and Owner Type

```{r,eval=FALSE}
#Looking at Top 10 Eviction Numbers by Umbrella Name
evic_by_owner <- complete_data_eda %>% count(Umbrl_N)

evic_by_owner_count <- evic_by_owner[order(-evic_by_owner$n),]

head(evic_by_owner_count,10)

#Looking at Top 10 Eviction Numbers by State
evic_by_owner_loc <- complete_data_eda %>% count(Mln_O_S)

evic_by_owner_loc_count <- evic_by_owner_loc[order(-evic_by_owner_loc$n),]

head(evic_by_owner_loc_count,10)

#Looking at Top 10 Eviction Rates by Umbrella Name 
#as.POSIXct(durham_apts$Start_Date)
#as.POSIXct(durham_apts$End_Date)
durham_apts_sliced_owners$elapsed.time <- durham_apts$Start_Date %--% durham_apts$End_Date

evic_rates_by_owner <- complete_data_eda %>% 
  group_by(Umbrl_N) %>% 
  summarize(total_evics = n(), 
            total_units = sum(sum_du),
            total_ownership = )

evic_rates_by_owner$evic_rate = evic_rates_by_owner$total_evics/(evic_rates_by_owner$total_units*19)

evic_rates_by_owner_count <- evic_rates_by_owner[order(-evic_rates_by_owner$evic_rate),]

head(evic_rates_by_owner_count,10)
```

# Checking Out Evictions By Date Served

```{r}
evic_ds_2018 = complete_data %>% filter(substr(Dateissued,1,4) == "2018") %>% count(Dateissued)

evic_ds_2018_plot <- ggplot(evic_ds_2018, aes(Dateissued, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ggtitle("Evictions in 2018 Based on Date Served")

evic_ds_2018_plot

sum(evic_ds_2018$n)
sum(evic_2018$n)
head(evic_ds_2018[order(-evic_ds_2018$n),],5)

parcels_evicting_nov_16 <- complete_data %>% filter(Dateissued == "2018-11-16") %>% group_by(PARCEL_ID) %>% count()

parcel_152986 <- complete_data %>% filter(PARCEL_ID == "152986") %>% count(Dateissued)

ggplot(parcel_152986, aes(Dateissued, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %y") +
  ylim(0,30) +
  ggtitle("Evictions for Parcel 152986")

parcel_152986_owner <- complete_data %>% filter(PARCEL_ID == "152986") %>% group_by(Umbrella.Name) %>% count(Mailing.Office.State)
```

# Checking Out Evictions By Date Served 

```{r}
evic_ds_by_date = complete_data %>% count(Dateissued)

ggplot(evic_ds_by_date, aes(Dateissued, n)) +
  geom_line() +
  scale_x_date(date_breaks = "1 year", date_labels = "%y") +
  ylim(0,150) +
  ggtitle("Evictions By Date Based on Date Served")
```

Again, we see that there is missing data in 2003. We also see that there is a similar cyclical pattern. That being said, we don't have as many observations: 19,127 of the 63,602 eviction records are NAs. 

# Standardizing Ownership Dates 

```{r}
#Figuring Out Length of Ownership for Each owner
durham_apts_sliced_owners$ownership_time = NA

durham_apts_sliced_owners$ownership_time = difftime(durham_apts_sliced_owners$End_Date,durham_apts_sliced_owners$Start_Date,units = "weeks")

#Filling in All Owner Names

durham_apts_sliced_owners$Umbrella.Name = as.character(durham_apts_sliced_owners$Umbrella.Name)

for (i in 1:length(durham_apts_sliced_owners$Umbrella.Name)) {
  if(durham_apts_sliced_owners$Umbrella.Name[i] == "") {
    durham_apts_sliced_owners$Umbrella.Name[i] = as.character(durham_apts_sliced_owners$Deed.Name[i])
  }
}

#Figuring Out Eviction Rate given length of ownership
owner_parcel_total_evictions <- complete_data %>% group_by(Umbrella.Name,PARCEL_ID,sum_du) %>% count()

complete_data$Umbrella.Name= as.character(complete_data$Umbrella.Name)
for (i in 1:length(complete_data$Umbrella.Name)) {
  if(complete_data$Umbrella.Name[i] == "") {
    complete_data$Umbrella.Name[i] = as.character(complete_data$Deed.Name[i])
  }
}

apt_evictions_eda <- durham_apts_sliced_owners 

apt_evictions_eda$total_evictions <- NA
apt_evictions_eda$sum_du <- NA

for (i in 1:length(apt_evictions_eda$PARCEL_ID)) {
  for (j in 1:length(owner_parcel_total_evictions$PARCEL_ID)) {
    if(identical(as.character(apt_evictions_eda$PARCEL_ID[i]),as.character(owner_parcel_total_evictions$PARCEL_ID[j])) == TRUE) {
      if(identical(as.character(apt_evictions_eda$Umbrella.Name[i]),as.character(owner_parcel_total_evictions$Umbrella.Name[j])) == TRUE) {
        apt_evictions_eda$total_evictions[i] = owner_parcel_total_evictions$n[j]
      }
    }
  }
}
```

```{r}
apt_evictions_eda$dwelling_count <- NA
for (i in 1:length(apt_evictions_eda$PARCEL_ID)) {
  for (j in 1:length(parcels_in_tract$PARCEL_)) {
    if (identical(as.character(apt_evictions_eda$PARCEL_ID[i]),as.character(parcels_in_tract$PARCEL_[j])) == TRUE) {
      apt_evictions_eda$dwelling_count[i] = parcels_in_tract$sum_du[j]
    }     
  }
}

apt_evictions_eda$weekly_evic_rate <- NA
apt_evictions_eda$weekly_evic_rate <- apt_evictions_eda$total_evictions/(as.numeric(apt_evictions_eda$dwelling_count)*as.numeric(apt_evictions_eda$ownership_time))
apt_evictions_eda$weekly_evic_rate[is.na(apt_evictions_eda$weekly_evic_rate)] <- 0
```

# Average Weekly Evic Rates

```{r}
average_weekly_evic_rates <- apt_evictions_eda %>% group_by(RHFS.Classifications) %>% summarise(mean_rate = mean(weekly_evic_rate),
              sd_rate = sd(weekly_evic_rate),
              max_rate = max(weekly_evic_rate),
              min_rate = min(weekly_evic_rate))                                                                                                         
```

#Different Dwelling Size Label Classifications 

```{r}
apt_evictions_eda$unit_sizes <- NA

for (i in 1:length(apt_evictions_eda$dwelling_count)) {
  if (apt_evictions_eda$dwelling_count[i] <= 5) {
    apt_evictions_eda$unit_sizes[i] = "tiny"
  }
  if (5 < apt_evictions_eda$dwelling_count[i] & apt_evictions_eda$dwelling_count[i] <= 24) {
    apt_evictions_eda$unit_sizes[i] = "small"
  }
  if (24 < apt_evictions_eda$dwelling_count[i] & apt_evictions_eda$dwelling_count[i] <= 50) {
    apt_evictions_eda$unit_sizes[i] = "medium"
  }
  if (50 < apt_evictions_eda$dwelling_count[i]) {
    apt_evictions_eda$unit_sizes[i] = "large"
  }
}

apt_evictions_eda$weekly_rate_by_size <- NA
apt_evictions_eda$weekly_rate_by_size <- apt_evictions_eda$total_evictions/as.numeric(apt_evictions_eda$ownership_time)
apt_evictions_eda$weekly_rate_by_size[is.na(apt_evictions_eda$weekly_rate_by_size)] <- 0

average_weekly_evic_rates <- apt_evictions_eda %>% group_by(RHFS.Classifications,unit_sizes) %>% summarise(mean_rate = mean(weekly_rate_by_size),
              sd_rate = sd(weekly_rate_by_size),
              max_rate = max(weekly_rate_by_size),
              min_rate = min(weekly_rate_by_size),
              total_owners = n())    

by_state <- apt_evictions_eda %>% group_by(Mailing.Office.State,unit_sizes) %>% summarise(mean_rate = mean(weekly_rate_by_size),
              sd_rate = sd(weekly_rate_by_size),
              max_rate = max(weekly_rate_by_size),
              min_rate = min(weekly_rate_by_size),
              total_owners = n())    
```


